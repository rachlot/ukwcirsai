{
    "ID": "Home",
    "layout": {
        "widget": "page",
        "children": [
            {
                "style": {
                    "maxWidth": "800px",
                    "margin": "0 auto",
                    "padding": "20px",
                    "borderRadius": "8px",
                    "boxShadow": "0 4px 12px rgba(0, 0, 0, 0.1)",
                    "backgroundColor": "#f9f9f9",
                    "fontFamily": "'Roboto', sans-serif"
                },
                "widget": "container",
                "children": [
                    {
                        "html": "<h1 style='font-size: 2.5em; font-weight: 700; color: #333;'>Vorfälle anonym berichten & helfen!</h1><p style='font-size: 1.1em; color: #555;'>Incidents, die in das CIRS (Critical Incidents Reporting System) eingetragen werden, sind <b>anonym</b> und können nicht mit der berichtenden Person in Verbindung gebracht werden.</p>",
                        "widget": "html"
                    },
                    {
                        "html": "<p style='font-size: 1.1em; color: #555;'>Durch das Teilen des Vorfalles können zukünftige Fälle verhindert werden!</p>",
                        "widget": "html"
                    },
                    {
                        "text": "Analysieren",
                        "expression": "{\n  \"bericht\": variable.bericht\n}",
                        "print": "(\n\n$x := $curl(\"POST\", \"https://api.openai.com/v1/chat/completions\", {\n    \"model\": \"gpt-4o-mini\",\n    \"response_format\": { \"type\": \"json_object\" },\n    \"messages\": [\n      {\n        \"role\": \"system\",\n        \"content\": \"Deine Aufgabe ist es, die Daten aus dem Bericht in ein JSON-Objekt zu übersetzen. Nutze dazu lediglich die Informationen der Eingabe. Fehlt eine Information in der Eingabe, nutze den Wert 'unbekannt'. Füge die folgenden Felder hinzu:\\n\\n\" &\n          \"Zuständiges Fachgebiet\\n\" &\n          \"Wo ist das Ereignis passiert\\n\" &\n          \"Tag des Ereignisses (Wochentag oder Wochenende)\\n\" &\n          \"Versorgungsart (Routinebetrieb oder Notfall)\\n\" &\n          \"ASA-Klassifizierung\\n\" &\n          \"Patientenzustand\\n\" &\n          \"Wichtige Begleitumstände\\n\" &\n          \"War ein Medizinprodukt beteiligt\\n\" &\n          \"Welches Medizinprodukt war beteiligt\\n\" &\n          \"Fallbeschreibung\\n\" &\n          \"Was war besonders gut\\n\" &\n          \"Was war besonders ungünstig\\n\" &\n          \"Wie häufig tritt ein Ereignis dieser Art auf\\n\"\n      },\n      {\n        \"role\": \"user\",\n        \"content\": form.bericht\n      }\n    ]\n }, {\"Authorization\": \"openai\"}).choices[0].message.content;\n\n$setVariable(\"cirs\", $parseJson($x));\n$setVariable(\"bericht\", form.bericht);\n$refresh(); \n\n$namensListe := $match(variable.bericht, /\\b[A-Z][a-z]+\\b/g) || [];\n\n$y := $curl(\"POST\", \"https://api.openai.com/v1/chat/completions\", {\n    \"model\": \"gpt-4o-mini\",\n    \"response_format\": { \"type\": \"json_object\" },\n    \"messages\": [\n      {\n        \"role\": \"system\",\n        \"content\": \"Deine Aufgabe ist es, den Bericht zu anonymisieren. Verwende auf gar keinen Fall Namen oder personenbezogene Daten\"\n      },\n      {\n        \"role\": \"user\",\n        \"content\": form.bericht\n      }\n    ]\n }).choices[0].message.content;\n\n$setVariable(\"anonymisierterBericht\", $y);\n$refresh();\n\n)",
                            "widget": "button", 
                            "schema": {
                            "type": "object",
                            "properties": {
                                "bericht": {
                                    "widget": "textarea",
                                    "style": {
                                        "width": "1200px"
                                    },
                                    "required": false,
                                    "title": "Bericht"
                                },
                            
                               "benutzerBegriff": {
                                    "widget": "select",
                                    "title": "Welche Bezeichnung passt am besten?",
                                    "enum": "$namensListe.length > 0 ? $namensListe.concat(['Arzt', 'Patient', 'Pflegekraft', 'Person']) : ['Arzt', 'Patient', 'Pflegekraft', 'Person']",
                                    "required": false
                                }

                            }
                        }
                    },
                    {
                        "text": "Speichern",
                        "expression": "variable.cirs",
                        "print": "$create(\"postgres\", \"Ereignis\", form)",
                        "title": "Vorschau",
                        "widget": "button",
                        "schema": {
                            "type": "object",
                            "properties": {
                                "Zuständiges Fachgebiet": {

                                },
                                "Altersgruppe des Patienten": {

                                },
                                "Wo ist das Ereignis passiert": {

                                },
                                "Welche Versorgungsart": {

                                },
                                "ASA-Klassifizierung": {

                                },
                                "Patientenzustand": {

                                },
                                "Wichtige Begleitumstände": {

                                },
                                "War ein Medizinprodukt beteiligt": {

                                },
                                "Medizinprodukt": {},
                                "Fallbeschreibung": {

                                },
                                "Was war besonders gut": {

                                },
                                "Was war besonders ungünstig": {

                                },
                                "Eigener Ratschlag": {

                                },
                                "Wie häufig tritt ein Ereignis dieser Art auf": {

                                },
                                "Ihre Berufserfahrung": {

                                },
                                "Name-Ersatz": {}
                            }
                        }
                    },
                    {
                        "html": "<h2 style='font-size: 1.5em; font-weight: 700; color: #333;'>Anonymisierter Bericht</h2><p style='font-size: 1.1em; color: #555;'>",
                        "widget": "html"
                    },
                    {
                        "widget": "variable",  
                        "value": {
                            "anonymisierterBericht": ""
                        },
                        "schema": {
                            "type": "object",
                            "properties": {
                                "anonymisierterBericht": {
                                    "widget": "textarea",
                                    "expression": "variable.anonymisierterBericht",
                                    "title": "Anonymisierter Bericht",
                                    "style": {
                                        "width": "1200px",
                                        "height": "300px"
                                    }
                                }
                            }
                        }
                    }
                ]
            }
        ]
    }
}
